---
obsidianUIMode: preview
---

# 曲げ見積りスキル：進捗確認

**Claude Code の画面やチャット履歴は直接は見れません。** 代わりに、コードと evals の実行結果から「今どこまで進んでいるか」をまとめました。

---

## 確認した日時と結果

- **evals 実行**: `python3 evals/run_evals.py` → **4 件とも成功**（0 失敗）
- ハット曲げ_小物_1個 / L曲げ_中物_1個 / コの字曲げ_10個_数量割引 / 四方曲げ_SUS304_1個 … すべて OK
- **evals の役割**: **曲げ単価ロジック**（基準価格×形状乗率×数量調整）の検証。穴あけ・材料費・切断費は含まない。

---

## 現在の状態（コード・データから分かること）

| 項目 | 状態 |
|:---|:---|
| **data/prices.json** | 基準価格テーブル（重量・長さ区分）。evals の期待値と一致して 4 件パス |
| **data/rates.json** | 形状乗率・数量調整・比重・縞板単位重量・**材料単価_円_per_kg**（350） |
| **data/hole_prices.json** | 穴あけ単価（板厚別）。Excel/他ツール用 |
| **evals/run_evals.py** | 曲げ単価のみ計算（穴あけなし）。展開幅×製品長さ×板厚×比重/1e9 で重量 |
| **evals/evals.json** | 4 ケース。期待値は現行 prices と整合 |
| **見積り計算書.html** | **材料費＋切断費＋曲げ工賃＋穴あけ**の4項目。縦L・横W・余長・形状・数量・穴数で計算。見積合計＝4項目の合計×数量 |
| **見積り計算書_仕様まとめ.md** | HTML の目的・計算式・データ参照の仕様まとめ（Claude Code で必読） |
| **実績メモ.md** | 決まった単価の案件をメモし、テーブル微調整に使う（ステップ2用） |
| **曲げ加工見積り_計算書.xlsx** | あり（中身は未検証） |
| **build_calc_sheet.py** | data/*.json から Excel を生成 |

---

## evals と HTML の違い

- **evals**: 曲げ単価（基準価格×形状乗率×数量調整）×数量。穴あけ・材料・切断なし。**計算ロジックの検証用**。
- **HTML**: 材料費（鉄単価×重量）＋切断費＋曲げ工賃（U20/O20 テーブル）＋穴あけ。**お客様への見積金額**を出す用。
- 重量の定義も異なる（evals は余長なし、HTML は余長テーブルあり）。そのため「HTML の見積合計」と「evals の見積り_税抜」は一致しないのが正常。

---

## 曲げkg単価の板厚別デフォルト（経緯）

- **初回指定**: ユーザーから「1.6/2.3→200、3.2/4.5→190、6mm以上→185、デフォルト185」の指定あり。その通り実装したが、**厚い6mmが薄い1.6より安い**表示になり矛盾。
- **指摘**: 「6mmの方が厚いのに1.6より高くなってるの？ありえない」→ 根拠を残したうえで、**厚いほど高く**（1.6/2.3→185、3.2/4.5→190、6mm以上→200）に修正済み。
- **根拠の記載場所**: `見積り計算書_仕様まとめ.md` の「4.4 曲げ工賃」内「曲げkg単価の板厚別デフォルト — 経緯と根拠」に上記やり取りを表で記載。

---

## 未整理・今後の確認

- **縦・横・余長** と **展開幅・製品長さ** の対応は、元の計算書の定義に合わせて揃えるとよい。
- **重量の厳密な定義**（20kg 境界でのテーブル切替など）は `見積り計算書_仕様まとめ.md` に記載済み。evals 側に余長や 20kg 境界を入れるかは別途検討。

---

## 進捗を確認する方法（自分で）

1. **evals**: `cd .claude/skills/bending-estimate` → `python3 evals/run_evals.py` → 4 件 OK で曲げ単価ロジックは整合。
2. **HTML**: ブラウザで `見積り計算書.html` を開き、材料・切断・曲げ・穴あけの内訳と見積合計が期待どおりか確認。
3. **実績**: 決まった単価は `実績メモ.md` に追記し、必要なら prices.json や Excel データを微調整。

---

*evals を再実行したら日付と結果をここにメモしておくと、あとから「どこまで進んでいたか」が分かりやすい。*
