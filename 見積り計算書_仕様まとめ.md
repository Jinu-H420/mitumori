# 曲げ加工 見積り計算書 — 仕様まとめ

このドキュメントは、`見積り計算書.html`（v4）の目的・構成・計算ロジック・データ参照をまとめたものです。

---

## 1. 目的と前提

- **材料・切断・曲げ・穴あけは別項目**である。重さと曲げは関係するが、切断と曲げは別物。
- **見積合計** ＝ **材料費** ＋ **切断費** ＋ **曲げ工賃** ＋ **穴あけ**（4項目をすべて足す）。
- 材料単価は `data/rates.json` の「材料単価_円_per_kg」を参照する（デフォルト 185 円/kg）。

---

## 2. 画面構成

| エリア | 内容 |
|--------|------|
| **上部** | タイトル＋目的の説明（材料・切断・曲げ・穴あけは別項目である旨） |
| **左カラム** | 製品情報 → 計算過程（重量・材料費・切断費・曲げ工賃・穴あけ・合計）→ 参考テーブル |
| **右カラム（sticky）** | 見積内訳（材料費・切断費・曲げ工賃・穴あけ・見積合計）＋ 材料重量・提示金額・社内基準・想定粗利 |

---

## 3. 製品情報（入力項目）

| 項目 | 説明・備考 |
|------|------------|
| 材質 | SS400 / SUS304 / CHP（縞板） |
| 板厚 | 1.6, 2.3, 3.2, 4.5, 6.0, 9.0, 12.0, 16.0, 19.0 mm |
| 縦 L / 横 W | 寸法（mm） |
| 余長 | 手入力。未入力時は板厚・ボンデに応じて自動（後述） |
| ボンデ鋼板 | ON で余長 +100 mm |
| 形状 | L曲げ〜ハット曲げ / 手入力（曲げ回数指定） |
| 数量 | 個数 |
| 丸穴(30φ未満) / 長穴 | 穴数（個） |

---

## 4. 計算の流れ

### 4.1 重量

- **計算用重量**（材料費・曲げ工賃用）  
  - 展開寸法 = (L+余長) × (W+余長)  
  - SS400/SUS304: 板厚 × 展開 × 比重 ÷ 1,000,000  
  - CHP: 板厚別単位重量（kg/m²）× 面積  
- **課金重量**（提示金額・社内基準・想定粗利用）  
  - 板厚×(L+余長)×(W+余長)×7.85÷1,000,000（余長は同じテーブル）

**余長テーブル（縦横とも加算）**

| 板厚 | 余長 |
|------|------|
| 1.6, 2.3 | 50 mm |
| 3.2 | 30 mm |
| 4.5 〜 19.0 | 20 mm |
| ボンデ ON | 100 mm |

### 4.2 材料費（鉄の単価×重量）

- **1個あたり** = 材料単価（円/kg）× 重量（kg）
- 材料単価: 初期値は `data/rates.json` の `材料単価_円_per_kg`（デフォルト 185）。画面上で変更可。↺で初期値に戻す。

### 4.3 切断費（切断長×単価）

- **1個あたり** = 切断長（mm）÷ 1000 × 切断単価（円/m）
- 切断長: 未入力時は外周概算 2×(L+余長)＋2×(W+余長) で自動。↺で再計算。
- 切断単価: デフォルト 150 円/m。↺で 150 に戻す。

### 4.4 曲げ工賃（1:kg単価・J9相当）

- **計算方法1**: 曲げkg単価（円/kg）× 重量。価格計算用_4の J9 セル相当。案件ごとに入力で変更可。
- **板厚別デフォルト**（↺でこの値に戻る）: 1.6/2.3→185、3.2/4.5→190、6mm以上→185 円/kg。案件で変更可。
- **530円相当**: 曲げは含めない。**材料費＋穴あけ**を10円単位で表示する行（例: 326+200→530）。
- 板厚で**グループ**（A〜E）・重量で 20kg 未満/以上を切り替える**参考テーブル**（U20/O20）もあり。実際の見積金額は「曲げkg単価×重量」を採用。

#### 曲げkg単価の板厚別デフォルト — 経緯と根拠

| 日付・やり取り | 内容 |
|:---|:---|
| **ユーザー指定（初回）** | 「厚みごとの単価設定を以下のようにしておきます。1. 1.6mm、2.3mm：キロ195円ではなく**200円** 2. 3.2mm、4.5mm：**190円** 3. 6mm以上：**185円** 入力できるようにはしてほしいですが、デフォルトでは185と入れておいてください。」→ この通り実装した（薄い→200、厚い→185）。 |
| **ユーザー指摘** | 「なんで1.6と6で、6mmの方が厚いのに1.6より高くなってるの？ありえないだろう。」— 当時の仕様では 1.6→200・6→185 で、**厚い方が安い**表示になっており矛盾。 |
| **修正方針** | 「逆にすればいい」ではなく、**厚いほど曲げ単価は高い**という実務に合わせてデフォルトを変更。1.6/2.3→**185**、3.2/4.5→**190**、6mm以上→**200** 円/kg に変更。根拠は上記のやり取りを本ドキュメントに残す。 |

### 4.5 穴あけ

- **1個あたり** = 丸穴単価 × 丸穴数 ＋ 長穴単価 × 長穴数
- 現在の HTML では **丸穴 50 円/個・長穴 70 円/個** で固定。  
  （`data/hole_prices.json` は別運用・Excel 等で参照想定）

### 4.6 見積合計（税抜）

- **1個あたり合計** = 材料費 ＋ 切断費 ＋ 曲げ工賃 ＋ 穴あけ
- **見積合計** = 1個あたり合計 × 数量

---

## 5. 参考表示（課金重量まわり）

- **課金重量**: 上記余長テーブル＋7.85 固定で計算。
- **提示金額**: 課金重量 × 提示単価（t3.2/t4.5 は 190 円/kg、それ以外 185 円/kg）。
- **社内基準**: 課金重量 × 155 円/kg。
- **想定粗利**: 提示金額 − 社内基準。

これらは参考用であり、見積合計の算出には使わない。

---

## 6. データの参照関係

| 参照元 | 用途 |
|--------|------|
| **data/rates.json** | 材料単価（`材料単価_円_per_kg`）。HTML 読み込み時に fetch。デフォルト 185 円/kg。 |
| **見積り計算書.html 内の定数** | 板厚グループ(TG)、曲げ回数(SB)、比重(GR)、縞板単位重量(SW)、余長(YOCHO)、曲げ単価テーブル(U20/O20)、穴あけ単価(HM=50,HN=70)、WT=20（20kg境界） |

※ `data/prices.json`（基準価格表）は Excel 生成用。HTML の曲げ単価は U20/O20 を直接保持。

---

## 7. 上書きとリセット（↺）

| 項目 | 上書き | ↺で戻る値 |
|------|--------|------------|
| 重量 | 手入力可能 | 自動計算値 |
| 材料単価 | 手入力可能 | rates.json または 185 円/kg |
| 切断長 | 手入力可能 | 外周自動計算 |
| 切断単価 | 手入力可能 | 150 円/m |
| 曲げ kg単価 | 手入力可能 | 板厚別デフォルト（1.6/2.3→185、3.2/4.5→190、6mm以上→185） |
| 穴あけ加算 | 手入力可能 | 丸穴・長穴数から自動 |

---

## 8. 曲げ単価テーブル概要（HTML 内）

- **板厚グループ**: A(1.6,2.3), B(3.2,4.5,6.0), C(9.0,12.0), D(16.0), E(19.0)
- **20 kg 未満**: 長さ区分（mm）ごとに [min 円, max 円]。横長で線形補間し、箇所単価×曲げ回数。
- **20 kg 以上**: 長さ区分ごとに 1曲げ（円/kg）と追加（円/kg）。重量と曲げ回数で計算。

詳細は画面の「参考: 単価テーブル」で確認可能。

---

## 9. ファイル一覧（関連）

| ファイル | 役割 |
|----------|------|
| **見積り計算書.html** | 本計算書。単体で開いて使用。 |
| **曲げ加工_まとめ表.html** | 曲げ見積の構成・板厚別単価・余長・形状別曲げ回数などを表でまとめた参照用。 |
| **data/rates.json** | 材料単価_円_per_kg、形状乗率、比重、縞板単位重量など。 |
| **data/prices.json** | 曲げ基準価格（Excel 用）。HTML は自前の U20/O20 を使用。 |
| **data/曲げ価格表.csv** | 形状×重量範囲×長さクラス別の基準単価（L・コの字・Z・C型・ハット）。別ツール・API用。 |
| **data/曲げ価格表_説明.md** | 上記CSVの列の意味・見積レスポンス例のキー説明。 |
| **data/見積レスポンス例.json** | API/スクリプトの見積結果の型の例（unit_price, material_cost, total_price, details）。 |
| **data/hole_prices.json** | 穴あけ単価（板厚別）。Excel/他ツール用。HTML は 50/70 円固定。 |
| **見積書を育てる方針.md** | 計算書→実績→見積書の進め方。 |
| **計算書の使い方.md** | Excel 計算書の使い方。 |

---

## 10. 運用メモ

- **材料単価を変えたい**: `data/rates.json` の `材料単価_円_per_kg` を編集。HTML を HTTP で開いている場合は再読み込みで反映。`file://` の場合は画面上の入力で変更。
- **曲げ単価を変えたい**: HTML 内の U20 / O20 を編集するか、計算過程の「曲げ工賃」の kg単価を手入力。形状×重量×長さの表引きが必要な場合は `data/曲げ価格表.csv` を参照（説明は `data/曲げ価格表_説明.md`）。
- **穴あけ単価を変えたい**: HTML 内の HM（丸穴）・HN（長穴）を変更するか、計算過程の「穴あけ加算」を手入力。
- **一覧で確認したい**: `曲げ加工_まとめ表.html` で板厚別単価・余長・形状別曲げ回数・価格計算用_4相当の目安を表形式で確認可能。

以上が、ここまでの見積り計算書の内容のまとめです。
